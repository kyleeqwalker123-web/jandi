<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reaction Hub</title>
    <style>
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; background: #000; color: white; font-family: -apple-system, sans-serif; overflow: hidden; height: 100dvh; }
        
        .main-layout { display: flex; flex-direction: column; height: 100%; }

        /* Video Area */
        #video-section { flex: 1; background: #000; position: relative; display: flex; align-items: center; justify-content: center; }
        #player { width: 100%; height: 100%; pointer-events: auto; }
        #reaction-layer { position: absolute; inset: 0; pointer-events: none; z-index: 10; }

        /* Emoji Animation */
        .emoji { position: absolute; bottom: -50px; font-size: 50px; animation: floatUp 2.5s ease-out forwards; }
        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-110vh) rotate(var(--rot)) translateX(var(--drift)); opacity: 0; }
        }

        /* Controls */
        .controls { background: #111; padding: 15px; border-top: 1px solid #333; }
        .input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        input { flex: 1; background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 10px; font-size: 14px; }
        .btn-red { background: #ff4757; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; }

        .reaction-row { display: flex; justify-content: space-between; align-items: center; }
        .deck { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
        .react-btn { background: #222; border: none; font-size: 24px; padding: 10px; border-radius: 12px; }
        .trivia-trigger { background: linear-gradient(45deg, #6a11cb, #2575fc); color: white; border: none; padding: 12px 20px; border-radius: 12px; font-weight: bold; }

        /* Trivia Overlay */
        #trivia-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .card { background: #1a1a1a; border: 2px solid #6a11cb; border-radius: 30px; padding: 40px; width: 100%; max-width: 350px; }
        #trivia-text { font-size: 22px; line-height: 1.4; margin-bottom: 30px; filter: blur(12px); transition: filter 0.6s ease; }
        .trivia-btn { padding: 12px 25px; border-radius: 10px; border: none; font-weight: bold; margin: 5px; color: white; }
    </style>
</head>
<body>

    <div class="main-layout">
        <div id="video-section">
            <div id="player"></div>
            <div id="reaction-layer"></div>
        </div>

        <div class="controls">
            <div class="input-row">
                <input type="text" id="yt-url" placeholder="Paste YouTube Link...">
                <button class="btn-red" onclick="loadVideo()">LOAD</button>
            </div>
            <div class="reaction-row">
                <div class="deck">
                    <button class="react-btn" onclick="react('üòÇ')">üòÇ</button>
                    <button class="react-btn" onclick="react('üò±')">üò±</button>
                    <button class="react-btn" onclick="react('üî•')">üî•</button>
                    <button class="react-btn" onclick="react('üíÄ')">üíÄ</button>
                    <button class="react-btn" onclick="react('üòà')">üòà</button>
                </div>
                <button class="trivia-trigger" onclick="openTrivia()">GAMES üîû</button>
            </div>
        </div>
    </div>

    <div id="trivia-overlay">
        <div class="card">
            <div id="trivia-cat" style="font-size:12px; color:#6a11cb; margin-bottom:10px; font-weight:bold;">SPICY TRIVIA</div>
            <p id="trivia-text">The question is hidden...</p>
            <button id="reveal-btn" class="btn-red" onclick="socket.emit('reveal_trivia', room)">REVEAL</button>
        </div>
        <div style="margin-top:20px;">
            <button class="trivia-btn" style="background:#6a11cb" onclick="nextTrivia('spicy')">üå∂Ô∏è Next Spicy</button>
            <button class="trivia-btn" style="background:#ff9f43" onclick="nextTrivia('dare')">üî• Next Dare</button>
            <button class="trivia-btn" style="background:#333" onclick="closeTrivia()">Back to Video</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const socket = io();
        const room = "reaction-hub-1"; // Custom room name
        socket.emit('join', room);

        // --- YOUTUBE SYNC ---
        let player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                videoId: 'dQw4w9WgXcQ',
                playerVars: { 'autoplay': 1, 'playsinline': 1, 'rel': 0 },
                events: { 'onStateChange': onPlayerStateChange }
            });
        }

        function loadVideo() {
            const url = document.getElementById('yt-url').value;
            const id = url.split('v=')[1]?.split('&')[0] || url.split('/').pop();
            if(id) socket.emit('video_change', { room, id });
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) socket.emit('video_action', { room, action: 'play' });
            if (event.data == YT.PlayerState.PAUSED) socket.emit('video_action', { room, action: 'pause' });
        }

        socket.on('video_change', (id) => player.loadVideoById(id));
        socket.on('video_action', (action) => {
            if(action === 'play') player.playVideo();
            if(action === 'pause') player.pauseVideo();
        });

        // --- REACTIONS ---
        function react(emoji) { socket.emit('send_reaction', { room, emoji }); }
        socket.on('receive_reaction', (emoji) => {
            const e = document.createElement('div');
            e.className = 'emoji'; e.innerText = emoji;
            e.style.left = (Math.random() * 80 + 10) + '%';
            e.style.setProperty('--drift', (Math.random() * 400 - 200) + 'px');
            e.style.setProperty('--rot', (Math.random() * 360) + 'deg');
            document.getElementById('reaction-layer').appendChild(e);
            setTimeout(() => e.remove(), 2500);
        });

        // --- DIRTY TRIVIA ---
        const triviaData = {
            spicy: [
                "What is your secret turn-on that sounds weird but works?",
                "Describe the most scandalous place you've ever thought about doing it.",
                "If we were trapped in this app for 24 hours, what would you want to do first?",
                "What‚Äôs one thing you‚Äôve always wanted to try but were too shy to ask?",
                "What is the most 'dirty' thing you‚Äôve done this week?"
            ],
            dare: [
                "Take a selfie with the most suggestive expression you can make.",
                "Describe what I'm wearing right now in the most detailed way possible.",
                "I dare you to whisper your favorite fantasy into a voice note and send it.",
                "Post a photo of your bed exactly as it is right now.",
                "Choose one item of clothing to remove for the next 10 minutes."
            ]
        };

        function openTrivia() { document.getElementById('trivia-overlay').style.display = 'flex'; }
        function closeTrivia() { document.getElementById('trivia-overlay').style.display = 'none'; }

        function nextTrivia(type) {
            const list = triviaData[type];
            const text = list[Math.floor(Math.random() * list.length)];
            socket.emit('sync_trivia', { room, category: type.toUpperCase(), text });
        }

        socket.on('receive_trivia', (data) => {
            openTrivia();
            document.getElementById('trivia-text').innerText = data.text;
            document.getElementById('trivia-cat').innerText = data.category;
            document.getElementById('trivia-text').style.filter = 'blur(12px)';
            document.getElementById('reveal-btn').style.display = 'inline-block';
        });

        socket.on('reveal_trivia', () => {
            document.getElementById('trivia-text').style.filter = 'none';
            document.getElementById('reveal-btn').style.display = 'none';
        });
    </script>
</body>
</html>
