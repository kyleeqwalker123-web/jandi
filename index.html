<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cineby Hub</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; background: #000; color: white; font-family: -apple-system, sans-serif; overflow: hidden; height: 100dvh; }
        
        /* --- SCREENS --- */
        .screen { position: fixed; inset: 0; z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #000; transition: 0.5s; }
        input { background: #1a1a1a; border: 1px solid #333; color: white; padding: 15px; border-radius: 12px; width: 280px; margin: 10px; text-align: center; font-size: 16px; }
        .btn { background: #ff4757; color: white; border: none; padding: 15px 40px; border-radius: 12px; font-weight: bold; cursor: pointer; }

        /* --- MAIN HUB --- */
        #hub { display: none; flex-direction: column; height: 100%; position: relative; }
        #video-container { flex: 1; background: #000; position: relative; }
        #player { width: 100%; height: 100%; }

        /* --- CHAT DRAWER --- */
        #chat-drawer {
            position: absolute; right: 0; top: 0; bottom: 100px; width: 280px;
            background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(15px);
            transform: translateX(100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2000; border-left: 1px solid #333; display: flex; flex-direction: column;
        }
        #chat-drawer.open { transform: translateX(0); }
        #msg-list { flex: 1; overflow-y: auto; padding: 15px; list-style: none; margin: 0; font-size: 13px; }
        .msg-item { margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 10px; width: fit-content; max-width: 90%; }

        /* --- UI OVERLAYS --- */
        #reaction-layer { position: absolute; inset: 0; pointer-events: none; z-index: 10; }
        .emoji { position: absolute; bottom: -50px; font-size: 40px; animation: floatUp 2.5s forwards; }
        @keyframes floatUp { to { transform: translateY(-110vh) translateX(var(--drift)); opacity: 0; } }

        .bottom-bar { background: #111; padding: 15px; z-index: 3000; border-top: 1px solid #222; }
        .deck { display: flex; justify-content: space-between; align-items: center; }
        
        /* --- TRIVIA --- */
        #trivia-box { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; flex-direction: column; align-items: center; justify-content: center; }
        .card { background: #1a1a1a; padding: 40px; border-radius: 30px; border: 2px solid #ff4757; text-align: center; max-width: 320px; }
    </style>
</head>
<body>

    <div id="gate" class="screen">
        <h1 style="letter-spacing:10px; font-weight:100;">CINEBY</h1>
        <input type="password" id="gateCode" placeholder="ENTER CODE" oninput="checkGate(this.value)">
    </div>

    <div id="login" class="screen" style="display:none;">
        <h2 style="color:#ff4757">Who are you?</h2>
        <select id="userLabel" style="padding:15px; width:280px; background:#1a1a1a; color:white; border-radius:12px; border:1px solid #333;">
            <option value="J">J</option>
            <option value="I">I</option>
        </select>
        <input type="text" id="roomName" placeholder="Room Name">
        <button class="btn" onclick="startHub()" style="margin-top:20px;">START</button>
    </div>

    <div id="hub">
        <div id="video-container">
            <div id="player"></div>
            <div id="reaction-layer"></div>
            <button onclick="toggleChat()" style="position:absolute; top:20px; right:20px; z-index:100; background:rgba(255,255,255,0.2); border:none; color:white; padding:10px; border-radius:8px;">ðŸ’¬ Chat</button>
        </div>

        <div id="chat-drawer">
            <ul id="msg-list"></ul>
            <div style="padding:10px; display:flex; gap:5px;">
                <input type="text" id="chatInput" style="width:100%; margin:0; font-size:12px;" placeholder="Say something...">
                <button onclick="sendMsg()" style="background:#ff4757; border:none; color:white; border-radius:8px; padding:0 10px;">â†‘</button>
            </div>
        </div>

        <div class="bottom-bar">
            <input type="text" id="yt-url" style="width:100%; margin:0 0 10px 0; font-size:12px;" placeholder="Paste YouTube Link...">
            <div class="deck">
                <div style="display:flex; gap:10px;">
                    <button class="btn" style="padding:10px 15px; background:#333;" onclick="react('ðŸ˜‚')">ðŸ˜‚</button>
                    <button class="btn" style="padding:10px 15px; background:#333;" onclick="react('ðŸ”¥')">ðŸ”¥</button>
                    <button class="btn" style="padding:10px 15px; background:#333;" onclick="react('ðŸ˜±')">ðŸ˜±</button>
                </div>
                <button class="btn" style="background:linear-gradient(to right, #6a11cb, #2575fc); padding:10px 15px;" onclick="openTrivia()">GAMES ðŸ”ž</button>
                <button class="btn" style="padding:10px 15px; background:red;" onclick="loadVideo()">LOAD</button>
            </div>
        </div>
    </div>

    <div id="trivia-box">
        <div class="card">
            <p id="trivia-text" style="filter:blur(10px);">Question hidden...</p>
            <button id="rev-btn" class="btn" onclick="socket.emit('reveal_trivia', room)">REVEAL</button>
        </div>
        <div style="margin-top:20px;">
            <button class="btn" style="background:#6a11cb" onclick="nextTrivia('spicy')">Next Spicy</button>
            <button class="btn" style="background:#333" onclick="closeTrivia()">Close</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const socket = io();
        let room, user, player;

        function checkGate(val) {
            if(val === "1234") { // Your Code
                document.getElementById('gate').style.display = 'none';
                document.getElementById('login').style.display = 'flex';
            }
        }

        function startHub() {
            room = document.getElementById('roomName').value;
            user = document.getElementById('userLabel').value;
            if(room) {
                document.getElementById('login').style.display = 'none';
                document.getElementById('hub').style.display = 'flex';
                socket.emit('join', { room, user });
            }
        }

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                videoId: 'dQw4w9WgXcQ',
                playerVars: { 'autoplay': 1, 'playsinline': 1 },
                events: { 'onStateChange': (e) => {
                    if (e.data == 1) socket.emit('video_action', { room, action: 'play' });
                    if (e.data == 2) socket.emit('video_action', { room, action: 'pause' });
                }}
            });
        }

        function loadVideo() {
            const url = document.getElementById('yt-url').value;
            const id = url.split('v=')[1]?.split('&')[0] || url.split('/').pop();
            if(id) socket.emit('video_change', { room, id });
        }

        socket.on('video_change', id => player.loadVideoById(id));
        socket.on('video_action', a => a === 'play' ? player.playVideo() : player.pauseVideo());

        // --- CHAT LOGIC ---
        function toggleChat() { document.getElementById('chat-drawer').classList.toggle('open'); }
        function sendMsg() {
            const m = document.getElementById('chatInput').value;
            if(m) {
                socket.emit('chat_msg', { room, user, msg: m });
                document.getElementById('chatInput').value = '';
            }
        }
        socket.on('chat_msg', d => {
            const li = document.createElement('li');
            li.className = 'msg-item';
            li.innerHTML = `<b>${d.user}:</b> ${d.msg}`;
            document.getElementById('msg-list').appendChild(li);
            document.getElementById('msg-list').scrollTop = 9999;
        });
        socket.on('load_history', h => h.forEach(d => socket.emit('chat_msg', d))); // Trick to trigger local draw

        // --- REACTIONS & TRIVIA ---
        function react(emoji) { socket.emit('send_reaction', { room, emoji }); }
        socket.on('receive_reaction', emoji => {
            const e = document.createElement('div');
            e.className = 'emoji'; e.innerText = emoji;
            e.style.left = Math.random()*80+10+'%';
            e.style.setProperty('--drift', (Math.random()*200-100)+'px');
            document.getElementById('reaction-layer').appendChild(e);
            setTimeout(() => e.remove(), 2500);
        });

        const spicy = ["Fantasy you've never told me?", "Worst place you've ever had a crush?", "Describe me in 3 spicy words."];
        function openTrivia() { document.getElementById('trivia-box').style.display = 'flex'; }
        function closeTrivia() { document.getElementById('trivia-box').style.display = 'none'; }
        function nextTrivia() {
            const text = spicy[Math.floor(Math.random()*spicy.length)];
            socket.emit('sync_trivia', { room, text });
        }
        socket.on('receive_trivia', d => {
            openTrivia();
            document.getElementById('trivia-text').innerText = d.text;
            document.getElementById('trivia-text').style.filter = 'blur(10px)';
            document.getElementById('rev-btn').style.display = 'block';
        });
        socket.on('reveal_trivia', () => {
            document.getElementById('trivia-text').style.filter = 'none';
            document.getElementById('rev-btn').style.display = 'none';
        });
    </script>
</body>
</html>
