<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
    // This connects the browser to your Render server
    const socket = io({
        transports: ['websocket'],
        upgrade: false
    });

    let currentRoom = "";
    let myLabel = "";

    function join() {
        const room = document.getElementById('roomInput').value.trim();
        const pass = document.getElementById('passInput').value.trim();
        myLabel = document.getElementById('userSelect').value;

        if (room && pass) {
            currentRoom = room + "_" + pass; 
            document.getElementById('setup').style.display = 'none';
            document.getElementById('chat').style.display = 'flex';
            // This sends a signal to Render to join the room
            socket.emit('join room', currentRoom);
            console.log("Joined room: " + currentRoom);
        }
    }

    document.getElementById('form').onsubmit = (e) => {
        e.preventDefault();
        const input = document.getElementById('input');
        if (input.value.trim()) {
            const data = { 
                id: Date.now(),
                room: currentRoom, 
                msg: input.value, 
                user: myLabel, 
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) 
            };
            socket.emit('chat message', data);
            input.value = '';
        }
    };

    socket.on('chat message', (data) => {
        const item = document.createElement('li');
        item.className = `msg msg-${data.user.toLowerCase()}`;
        item.id = "msg-" + data.id;
        item.innerHTML = `<span class="label">${data.user} â€¢ ${data.time}</span>${data.msg}<div class="reaction-badge"></div>`;
        document.getElementById('messages').appendChild(item);
        document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    });
</script>
