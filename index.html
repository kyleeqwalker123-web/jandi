<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>J & I Hub</title>
    <style>
        :root { --accent: #ff4757; }
        body { font-family: sans-serif; background: #121212; color: white; margin: 0; height: 100dvh; overflow: hidden; }
        
        /* Setup */
        #setup { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; gap: 15px; }
        .card { background: #1e1e1e; padding: 30px; border-radius: 20px; display: flex; flex-direction: column; gap: 10px; width: 300px; }
        input, select { padding: 12px; border-radius: 10px; border: 1px solid #333; background: #333; color: white; }

        /* Hub */
        #hub { display: none; flex-direction: column; height: 100%; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; list-style: none; margin: 0; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 80%; background: #333; }
        .my-msg { background: var(--accent); align-self: flex-end; }
        
        .toolbar { display: flex; gap: 10px; padding: 10px; background: #1a1a1a; overflow-x: auto; }
        .tool-btn { background: #333; border: none; color: white; padding: 8px 15px; border-radius: 8px; font-size: 12px; white-space: nowrap; }

        /* Trivia Overlay */
        #trivia-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 5000; flex-direction: column; align-items: center; justify-content: center; }
        .trivia-card { background: #1e1e1e; border: 2px solid var(--accent); padding: 30px; border-radius: 20px; text-align: center; width: 85%; }
        
        #video-box { height: 0; transition: 0.3s; background: #000; }
    </style>
</head>
<body>

    <div id="setup">
        <h2 style="color:var(--accent)">ENTER HUB</h2>
        <div class="card">
            <select id="userSel"><option value="J">J</option><option value="I">I</option></select>
            <input type="text" id="roomName" placeholder="Room Name">
            <input type="password" id="pass" placeholder="Passcode (1234)">
            <button onclick="join()" style="background:var(--accent); color:white; border:none; padding:15px; border-radius:10px;">ENTER</button>
        </div>
    </div>

    <div id="hub">
        <div id="video-box"><div id="player" style="width:100%; height:200px;"></div></div>
        
        <div class="toolbar">
            <button class="tool-btn" onclick="askVideo()">üì∫ Sync Video</button>
            <button class="tool-btn" style="background:#6a11cb" onclick="openTrivia()">üîû Trivia Game</button>
            <button class="tool-btn" onclick="sendImg()">üñºÔ∏è Photo</button>
        </div>

        <ul id="messages"></ul>

        <div style="padding:15px; display:flex; gap:10px; background:#1e1e1e;">
            <input id="m-input" style="flex:1" placeholder="Type a message...">
            <button onclick="send()" style="background:var(--accent); border:none; color:white; padding:10px 20px; border-radius:10px;">Send</button>
        </div>
    </div>

    <div id="trivia-overlay">
        <div class="trivia-card">
            <p id="trivia-text" style="filter:blur(10px); font-size:18px;">Question hidden...</p>
            <button id="rev-btn" onclick="socket.emit('reveal_trivia', currentRoom)" style="background:var(--accent); color:white; border:none; padding:10px 20px; border-radius:10px; margin-top:10px;">REVEAL</button>
        </div>
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button onclick="nextTrivia()" style="background:#6a11cb; color:white; border:none; padding:10px; border-radius:8px;">Next Question</button>
            <button onclick="document.getElementById('trivia-overlay').style.display='none'" style="background:#444; color:white; border:none; padding:10px; border-radius:8px;">Close</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const socket = io();
        let currentRoom, myUser, ytPlayer;

        function join() {
            if(document.getElementById('pass').value !== "1234") return alert("Wrong code");
            currentRoom = document.getElementById('roomName').value;
            myUser = document.getElementById('userSel').value;
            document.getElementById('setup').style.display = 'none';
            document.getElementById('hub').style.display = 'flex';
            socket.emit('join room', { room: currentRoom, user: myUser });
        }

        function send() {
            const m = document.getElementById('m-input').value;
            if(m) { socket.emit('chat message', { room: currentRoom, user: myUser, msg: m }); document.getElementById('m-input').value = ''; }
        }

        socket.on('chat message', d => {
            const li = document.createElement('li');
            li.className = 'msg ' + (d.user === myUser ? 'my-msg' : '');
            li.innerHTML = `<small style="opacity:0.5">${d.user}</small><br>${d.msg}`;
            document.getElementById('messages').appendChild(li);
            document.getElementById('messages').scrollTop = 9999;
        });

        // YouTube
        function onYouTubeIframeAPIReady() { ytPlayer = new YT.Player('player'); }
        function askVideo() {
            const url = prompt("Paste YouTube URL:");
            if(url) {
                const id = url.split('v=')[1]?.split('&')[0] || url.split('/').pop();
                socket.emit('sync video', { room: currentRoom, id });
            }
        }
        socket.on('sync video', d => {
            document.getElementById('video-box').style.height = '200px';
            ytPlayer.loadVideoById(d.id);
        });

        // Trivia
        const questions = ["What is your secret turn-on?", "Most embarrassing memory?", "One thing you want to try together?"];
        function openTrivia() { document.getElementById('trivia-overlay').style.display = 'flex'; }
        function nextTrivia() {
            const q = questions[Math.floor(Math.random()*questions.length)];
            socket.emit('sync_trivia', { room: currentRoom, text: q });
        }
        socket.on('receive_trivia', d => {
            openTrivia();
            document.getElementById('trivia-text').innerText = d.text;
            document.getElementById('trivia-text').style.filter = 'blur(10px)';
            document.getElementById('rev-btn').style.display = 'block';
        });
        socket.on('reveal_trivia', () => {
            document.getElementById('trivia-text').style.filter = 'none';
            document.getElementById('rev-btn').style.display = 'none';
        });
    </script>
</body>
</html>
